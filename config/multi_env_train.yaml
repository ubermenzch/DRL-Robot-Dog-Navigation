# 多环境并行训练配置文件
# 所有可配置参数都在此文件中设置

gpu_id: 5  # 使用的GPU编号（与单环境配置一致）

# ==================== 训练参数 ====================
num_envs: 32  # 并行环境数量
batch_size: 2048  # 批次大小（与单环境保持一致）
training_iterations: 200  # 每轮训练迭代次数（对齐单环境配置）
max_steps_ratio: 0  # 每Episode最大步数比例 (max_steps = target_distance * max_steps_ratio)
max_steps_fixed: 300  # 当 max_steps_ratio=0 时，使用此固定max_steps
max_steps_min: 50  # 每Episode最小步数 (max_steps不会小于此值)
save_every_training: 50  # 每多少次训练保存一次模型s
buffer_size: 50000  # 重放缓冲区大小
report_every_episode: 200  # 每多少个episode输出一次统计报告
stats_window_size: 1000  # 统计窗口大小（最近X个episode）
max_training_count: 5000  # 最大训练次数（训练完成后自动停止）
total_eval_episodes: 0  # 评估阶段采集的episode数量；>0时训练结束后进入评估并在完成后输出统一统计报告

# ==================== 机器人和环境参数 ====================
max_velocity: 2.5  # 最大速度（对齐单环境）
max_acceleration: 5.0  # 最大加速度（m/s^2，对齐单环境）
max_deceleration: 5.0  # 最大减速度（m/s^2，建议填负值表示减速幅度，代码会取绝对值）
max_yawrate: 30.0  # 最大偏航率（单位：度/秒，对齐单环境）
neglect_angle: 30  # 前方视野左右两边忽略的角度（单位：度，对齐单环境）
scan_range: 10  # 激光雷达扫描范围（对齐单环境）
max_target_dist: 6.0  # 最大目标距离（对齐单环境）
init_target_distance: 2.0  # 初始目标距离（对齐单环境）
target_dist_increase: 0.001  # 目标距离增加量（对齐单环境）
target_reached_delta: 0.8  # 目标到达判断阈值
collision_delta: 0.4  # 碰撞判断阈值
world_size: 10  # 世界大小（单位：米，对齐单环境）
obs_min_dist: 1.0  # 障碍物圆心最小距离（单位：米，对齐单环境）（已废弃）
obs_num: 30  # 障碍物数量（对齐单环境）
obs_distribution_mode: "random"  # 障碍物生成方式："uniform"=均匀分布（默认），"random"=随机分布
costmap_resolution: 1  # costmap 分辨率（米/格）
obstacle_size: 1.0  # costmap 中障碍物等效边长（米，默认正方形）
region_select_bias: 0.7  # 选择“最大连通区域”的概率：1.0=总是选择最大区域；0.8=80%概率选最大，否则从剩余区域随机选

# ==================== 模型参数 ====================
action_dim: 2  # 模型产生的动作数量
max_action: 1  # 输出动作的最大绝对值
state_dim: 25  # 神经网络输入值的数量（状态输入向量长度）
device: "auto"  # 设备选择："auto"自动选择，"cuda"使用GPU，"cpu"使用CPU

# ==================== 网络结构参数 ====================
hidden_dim: 1024  # 神经网络隐藏层维度（对齐单环境）
hidden_depth: 3  # 神经网络隐藏层深度（对齐单环境）

# ==================== 训练算法参数 ====================
critic_loss_threshold: -1.0  # critic损失阈值，前X次平均损失小于此值时才更新模型；若值为-1，则无视该阈值，环境控制进程均使用最新模型。
actor_update_frequency: 1  # Actor网络更新频率（每多少次critic更新后更新一次actor）
critic_target_update_frequency: 2  # Critic目标网络更新频率（每多少次critic更新后更新一次目标网络）
avg_loss_window_size: 5  # 平均损失计算窗口大小（前X次训练）

# ==================== 路径参数 ====================
model_save_dir: "/home/zc/DRL-Robot-Navigation-ROS2/models/multi_env_train_model"  # 模型保存基目录，训练启动时会在此下创建时间戳子目录保存模型与config_used.yaml
model_load_dir: "/home/zc/DRL-Robot-Navigation-ROS2/models/multi_env_train_model/20251216_183606"  # 模型加载目录
load_existing_model: false  # 是否加载已有模型
log_dir: "/home/zc/DRL-Robot-Navigation-ROS2/log/multi_env_training"  # 日志保存基目录，启动训练时会在此下按时间戳创建子目录存放日志
gazebo_wait_time: 15  # Gazebo启动等待时间（秒）

# ==================== 奖励函数参数 ====================
goal_reward: 100.0  # 到达目标的奖励（对齐单环境）
collision_penalty_base: -100.0  # 碰撞惩罚系数（对齐单环境）
angle_penalty_base: -0.5  # 角度偏差基础惩罚（对齐单环境）
linear_penalty_base: -0.2  # 线速度基础惩罚（对齐单环境）

# ==================== 障碍物距离惩罚参数 ====================
obs_penalty_threshold: -1.0  # 障碍物距离惩罚阈值；-1时按|线速度|*sim_time自动计算（对齐单环境）
min_obs_penalty_threshold: 0.5  # 动态计算阈值时的最小阈值下限，避免阈值过小
obs_penalty_base: -0.5  # 障碍物距离惩罚基础系数（对齐单环境）
obs_penalty_power: 2.0  # 障碍物距离惩罚指数
obs_penalty_high_weight: 1.0  # 中间高权重区域惩罚权重
obs_penalty_low_weight: 0.4  # 两侧低权重区域惩罚权重
obs_penalty_middle_ratio: 0.4  # 中间高权重区域比例（0-1）
enable_obs_penalty: false  # 是否启用障碍物距离惩罚
enable_yawrate_penalty: false  # 是否启用角速度惩罚
enable_angle_penalty: true  # 是否启用角度偏移惩罚
enable_linear_penalty: true  # 是否启用线速度惩罚
yawrate_penalty_base: -0.5  # 角速度惩罚系数（对齐单环境）
reward_debug: false  # 是否打印奖励/惩罚明细

# ==================== 时间控制参数 ====================
sim_time: 2.0  # 仿真步长（对齐单环境）
step_sleep_time: 0.1  # step方法中的sleep时间（秒）
eval_sleep_time: 1.0  # eval方法中的sleep时间（秒）
reset_step_count: 3  # reset方法中调用step的次数

# ==================== 动作噪声参数（已弃用） ====================
# 注意：在SAC算法中，此参数实际上不再使用
# SAC是随机策略，探索性由策略分布本身控制，通过目标熵值（自动设置为-action_dim）调整alpha来控制
# 训练时使用策略分布采样（dist.sample()），评估时使用策略均值（dist.mean）
# 此参数保留仅为向后兼容，实际不影响训练
action_noise_std: 0.2  # [已弃用] SAC中不再使用额外动作噪声，探索由策略分布控制

# ==================== 调试参数 ====================
is_code_debug: false  # 是否为调试代码
enable_weight_consistency_check: false  # 是否进行模型权重一致性详细检验（为true时会在每个环境初始化时打印大量权重信息）

